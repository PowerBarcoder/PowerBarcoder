<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- jQuery library -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Socket I/O JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
          crossorigin="anonymous">

    <!--  Beautify output  -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/obsidian.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>

    <!-- font awesome   -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <title>PowerBarcoder</title>
    <style>
        .dropdown-toggle::after {
            display: inline-block;
            margin-left: .255em;
            vertical-align: .255em;
            content: "";
            border-top: .3em solid;
            border-right: .3em solid transparent;
            border-bottom: 0;
            border-left: .3em solid transparent;
        }

        .information {
            display: block;
            max-height: 0;
            overflow: hidden;
            transition: max-height 1s ease-in-out;
        }

        #tooltip99:hover + .information {
            max-height: 1000px;
        }

        #tooltip98:hover + .information {
            max-height: 1000px;
        }

        #tooltip97:hover + .information {
            max-height: 1000px;
        }

        #tooltip96:hover + .information {
            max-height: 1000px;
        }

        #tooltip95:hover + .information {
            max-height: 1000px;
        }

        #tooltip94:hover + .information {
            max-height: 1000px;
        }

        #tooltip93:hover + .information {
            max-height: 1000px;
        }

        #tooltip0:hover + .information {
            max-height: 1000px;
        }

        #tooltip1:hover + .information {
            max-height: 1000px;
        }

        #tooltip2:hover + .information {
            max-height: 1000px;
        }

        #tooltip3:hover + .information {
            max-height: 1000px;
        }

        #tooltip4:hover + .information {
            max-height: 1000px;
        }

        #tooltip5:hover + .information {
            max-height: 1000px;
        }

        #tooltip6:hover + .information {
            max-height: 1000px;
        }

        #tooltip7:hover + .information {
            max-height: 1000px;
        }

        #tooltip8:hover + .information {
            max-height: 1000px;
        }

        #tooltip9:hover + .information {
            max-height: 1000px;
        }

        #tooltip10:hover + .information {
            max-height: 1000px;
        }

        #tooltip11:hover + .information {
            max-height: 1000px;
        }

        #tooltip12:hover + .information {
            max-height: 1000px;
        }

        #tooltip13:hover + .information {
            max-height: 1000px;
        }

        #tooltip14:hover + .information {
            max-height: 1000px;
        }

        #tooltip15:hover + .information {
            max-height: 1000px;
        }

        /*隱藏scroll bar*/
        pre code.hljs {
            overflow-x: hidden;
        }

        /*自動換行*/
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .advanceMode {
            color: red;
        }

        .showAdvanceMode {
            display: block;

        }

        .hideAdvanceMode {
            display: none;
        }


    </style>

</head>
<body>
<div class="container">
    <br>
    <div class="container">
        <div class="row">
            <div class="col-md-12 d-md-flex justify-content-md-end">
                <button type="button" class=" btn btn-secondary" onclick="openAdvanceMode()"> v.<i>Beta</i></button>
            </div>
        </div>
    </div>
    <h1>PowerBarcoder GUI</h1>
    <p class="lead">Please fill out the following form and submit to start the analysis.</p>
    <form method="post">
        <div class="border border-gray p-3 bg-light">
            <div class="d-flex align-items-center">
                <h4 class="m-0">Path</h4>
                <button id="pathFormContainerToggleBtn" class="btn btn-primary dropdown-toggle ms-auto" type="button"
                        data-bs-toggle="collapse" href="#pathFormContainer" aria-expanded="false"
                        aria-controls="pathFormContainer">
                    Hide the Path Form
                </button>
            </div>
            <div id="pathFormContainer" class="mt-3 collapse">
                <!--                                <div class="form-group">-->
                <!--                                    <label for="myCutadaptPath">Cutadapt path:</label>-->
                <!--                                    <div class="row">-->
                <!--                                        <div class="col-12">-->
                <!--                                            <input type="text" class="form-control" id="myCutadaptPath" name="myCutadaptPath"-->
                <!--                                                   placeholder='{{default_mycutadapt_path}}' disabled>-->
                <!--                                        </div>-->
                <!--                                    </div>-->
                <!--                                </div>-->
                <!--                <div class="form-group">-->
                <!--                    <label for="myFastpPath">Fastp path:</label>-->
                <!--                    <div class="row">-->
                <!--                        <div class="col-12">-->
                <!--                            <input type="text" class="form-control" id="myFastpPath" name="myFastpPath"-->
                <!--                                   placeholder="{{default_myfastp_path}}" disabled>-->
                <!--                        </div>-->
                <!--                    </div>-->
                <!--                </div>-->
                <!--                <div class="form-group">-->
                <!--                    <label for="localBlastToolDir">Blast path:</label>-->
                <!--                    <div class="row">-->
                <!--                        <div class="col-12">-->
                <!--                            <input type="text" class="form-control" id="localBlastToolDir" name="localBlastToolDir"-->
                <!--                                   placeholder="{{default_localblast_tool_dir}}" disabled>-->
                <!--                        </div>-->
                <!--                    </div>-->
                <!--                </div>-->
                <!--                <div class="form-group">-->
                <!--                    <label for="resultDataPath">Result path:</label>-->
                <!--                    <div class="row">-->
                <!--                        <div class="col-12">-->
                <!--                            <input type="text" class="form-control" id="resultDataPath" name="resultDataPath"-->
                <!--                                   placeholder="{{default_result_data_path}}" disabled>-->
                <!--                        </div>-->
                <!--                    </div>-->
                <!--                </div>-->
                <!--                <div class="form-group">-->
                <!--                    <label for="missList">Missing list path:</label>-->
                <!--                    <div class="row">-->
                <!--                        <div class="col-12">-->
                <!--                            <input type="text" class="form-control" id="missList" name="missList"-->
                <!--                                   placeholder="{{default_miss_list}}" disabled>-->
                <!--                        </div>-->
                <!--                    </div>-->
                <!--                </div>-->

                <div class="form-group">
                    <label for="ampliconInfo">
                        <span id="tooltip99">Raw Files Folder Path: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                The path of the raw data file within,
                                including "R1 fastq.gz", "R2 fastq.gz",
                                "Dada2 Barcode file", "Barcodes File 1",
                                "Barcodes File 2", and "Sseqid File".
                            </i>
                        </span>
                    </label>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control" id="ampliconInfo" name="ampliconInfo"
                                   required="required"
                                   placeholder="{{default_amplicon_info}}" onkeyup="addRawFolderPath()">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="R1FastqGz">
                        <span id="tooltip0">R1 fastq.gz file path: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                Raw data (.gz) path within the mounted folder "../amplicon_data/"
                            </i>
                        </span>
                    </label>
                    <div class="row">
                        <div class="col">
                            <input type="text" class="form-control rawFolderPath" required="required"
                                   placeholder="{{TODO}}" disabled="disabled">
                        </div>
                        <div class="col">
                            <input type="text" class="form-control" id="R1FastqGz" name="R1FastqGz" required="required"
                                   placeholder="{{default_r1_fastq_gz}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="R2FastqGz">
                        <span id="tooltip1">R2 fastq.gz file path: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                Raw data (.gz) path within the mounted folder "../amplicon_data/"
                            </i>
                        </span>
                    </label>
                    <div class="row">
                        <div class="col">
                            <input type="text" class="form-control rawFolderPath" required="required"
                                   placeholder="{{TODO}}" disabled="disabled">
                        </div>
                        <div class="col">
                            <input type="text" class="form-control" id="R2FastqGz" name="R2FastqGz" required="required"
                                   placeholder="{{default_r2_fastq_gz}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="dada2LearnErrorFile">
                        <span id="tooltip2">Dada2 Learn Error Files Folder Path: <i
                                class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                File path within the mounted folder for DADA2 learning error, remember to put the fastq files under this path
                            </i>
                        </span>
                    </label>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control" id="dada2LearnErrorFile" name="dada2LearnErrorFile"
                                   required="required"
                                   placeholder="{{default_dada2_learn_error_file}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="dada2BarcodeFile">
                        <span id="tooltip3">Dada2 Barcode File: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                File name within the mounted folder "../amplicon_data/" for DADA2 learning error
                            </i>
                        </span>
                    </label>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control" id="dada2BarcodeFile" name="dada2BarcodeFile"
                                   required="required"
                                   placeholder="{{default_dada2_barcode_file}}">
                        </div>
                    </div>
                </div>


                <div class="form-group advanceMode hideAdvanceMode">
                    <label for="dev_mode">
                        <span id="tooltip98">Develop Mode: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                If you want to use the develop mode, please set it to "1", otherwise, set it to "0<br>
                                # 0: off (keep all the intermediate files),<br>
                                # 1: on  (cleanup all the intermediate files)
                            </i>
                        </span>
                    </label>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control dev_mode" id="dev_mode" name="dev_mode"
                                   required="required" value="{{dev_mode}}"
                                   placeholder="{{dev_mode}}">
                        </div>
                    </div>
                </div>


                <div class="form-group advanceMode hideAdvanceMode">
                    <label for="amplicon_minimum_length">
                        <span id="tooltip97">Amplicon Minimum Length: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                The minimum length of amplicon, default is 1
                            </i>
                        </span>
                    </label>

                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control amplicon_minimum_length" id="amplicon_minimum_length"
                                   name="amplicon_minimum_length"
                                   required="required" value="{{amplicon_minimum_length}}"
                                   placeholder="{{amplicon_minimum_length}}">
                        </div>
                    </div>
                </div>

                <br>
                <div class="d-flex align-items-center">
                    <button id="autoCompletePath" class="btn btn-warning" type="button"
                            onclick="autoCompleteWithDefaultPath()">
                        Use Demo Path
                    </button>
                </div>
            </div>
        </div>

        <script>
            function autoCompleteWithDefaultPath() {
                // document.getElementById('myCutadaptPath').value='{{default_mycutadapt_path}}'
                // document.getElementById('myFastpPath').value='{{default_myfastp_path}}'
                // document.getElementById('localBlastToolDir').value='{{default_localblast_tool_dir}}'
                document.getElementById('ampliconInfo').value = '{{default_amplicon_info}}'
                // document.getElementById('resultDataPath').value='{{default_result_data_path}}'
                // document.getElementById('missList').value='{{default_miss_list}}'
                document.getElementById('R1FastqGz').value = '{{default_r1_fastq_gz}}'
                document.getElementById('R2FastqGz').value = '{{default_r2_fastq_gz}}'
                // document.getElementById('summaryJsonFileName').value='{{default_summary_json_file_name}}'
                // document.getElementById('summaryHtmlFileName').value='{{default_summary_html_file_name}}'
                document.getElementById('dada2LearnErrorFile').value = '{{default_dada2_learn_error_file}}'
                document.getElementById('dada2BarcodeFile').value = '{{default_dada2_barcode_file}}'
                addRawFolderPath()
            }

            function openAdvanceMode() {
                let advanceMode = document.getElementsByClassName("advanceMode");
                for (let i = 0; i < advanceMode.length; i++) {
                    if (advanceMode[i].classList.contains("showAdvanceMode")) {
                        advanceMode[i].classList.remove("showAdvanceMode");
                        advanceMode[i].classList.add("hideAdvanceMode");
                    } else {
                        advanceMode[i].classList.add("showAdvanceMode");
                        advanceMode[i].classList.remove("hideAdvanceMode");
                    }
                }
            };

        </script>


        <!-- blank div -->
        <hr>
        <div class="border border-gray p-3 bg-light">
            <div class="d-flex align-items-center">
                <h4 class="m-0">Locus</h4>
                <button id="locusFormContainerToggleBtn" class="btn btn-primary dropdown-toggle ms-auto" type="button"
                        data-bs-toggle="collapse" href="#locusFormContainer" aria-expanded="false"
                        aria-controls="pathFormContainer">
                    Hide the Locus Form
                </button>
            </div>
            <div id="locusFormContainer" class="mt-3  collapse">
                <div class="form-group">
                    <label for="nameOfLoci">
                        <span id="tooltip4">Name of Loci: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                Locus name for your data
                            </i>
                        </span>
                    </label>

                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control nameOfLoci" id="nameOfLoci" name="nameOfLoci"
                                   required="required"
                                   placeholder="{{rbcl_name_of_loci}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="primerF">
                        <span id="tooltip7">Primer F: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                Primer F sequence for this locus
                            </i>
                        </span>
                    </label>
                    <div class="row">
                        <div class="col">
                            <input type="text" class="form-control primerFName" required="required"
                                   placeholder="{{rbcl_primer_f_name}}" id="primerFName" name="primerFName">
                        </div>
                        <div class="col">
                            <input type="text" class="form-control primerF" id="primerF"
                                   name="primerF" required="required"
                                   placeholder="{{rbcl_primer_f}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="primerR">
                        <span id="tooltip8">Primer R: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                Primer R sequence for this locus
                            </i>
                        </span>
                    </label>
                    <div class="row">
                        <div class="col">
                            <input type="text" class="form-control primerRName" required="required"
                                   placeholder="{{rbcl_primer_r_name}}" id="primerRName" name="primerRName">
                        </div>
                        <div class="col">
                            <input type="text" class="form-control primerR" id="primerR"
                                   name="primerR" required="required"
                                   placeholder="{{rbcl_primer_r}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="barcodesFile1">
                        <span id="tooltip11">Barcodes File 1: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                Barcodes file within the mounted folder "../amplicon_data/" for R1 fastq, should be prepared by yourself
                            </i>
                        </span>
                    </label>

                    <div class="row">
                        <div class="col">
                            <input type="text" class="form-control rawFolderPath" required="required"
                                   placeholder="{{TODO}}" disabled="disabled">
                        </div>
                        <div class="col">
                            <input type="text" class="form-control barcodesFile1" id="barcodesFile1"
                                   name="barcodesFile1" required="required"
                                   placeholder="{{rbcl_barcodes_file1}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="barcodesFile2">
                        <span id="tooltip12">Barcodes File 2: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                Barcodes file within the mounted folder "../amplicon_data/" for R2 fastq, should be prepared by yourself
                            </i>
                        </span>
                    </label>
                    <div class="row">
                        <div class="col">
                            <input type="text" class="form-control rawFolderPath" required="required"
                                   placeholder="{{TODO}}" disabled="disabled">
                        </div>
                        <div class="col">
                            <input type="text" class="form-control barcodesFile2"
                                   id="barcodesFile2"
                                   name="barcodesFile2" required="required"
                                   placeholder="{{rbcl_barcodes_file2}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="sseqidFileName">
                        <span id="tooltip13">Sseqid File: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                Library file within the mounted folder "../amplicon_data/" for local BLAST,
                                should be prepared by yourself.
                                We suggest user to use close related species as the library.
                            </i>
                        </span>
                    </label>

                    <div class="row">
                        <div class="col">
                            <input type="text" class="form-control rawFolderPath" required="required"
                                   placeholder="{{TODO}}" disabled="disabled">
                        </div>
                        <div class="col">
                            <input type="text" class="form-control sseqidFileName"
                                   id="sseqidFileName"
                                   name="sseqidFileName"
                                   required="required"
                                   placeholder="{{rbcl_sseqid_file_name}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="errorRateCutadapt">
                        <span id="tooltip5"> Cutadapt Error Rate: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                Trimming sensitivity for cutadapt, details can be found in cutadapt manual
                            </i>
                        </span>
                    </label>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control errorRateCutadapt" id="errorRateCutadapt"
                                   name="errorRateCutadapt" required="required"
                                   placeholder="{{rbcl_error_rate_cutadapt}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="minimumLengthCutadapt">
                        <span id="tooltip6">Cutadapt Minimum Length: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                Trimming length threshold for cutadapt, details can be found in cutadapt manual
                            </i>
                        </span>
                    </label>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control minimumLengthCutadapt" id="minimumLengthCutadapt"
                                   name="minimumLengthCutadapt" required="required"
                                   placeholder="{{rbcl_minimum_length_cutadapt}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="minimumLengthCutadaptInLoop">
                        <span id="tooltip14"> Cutadapt Minimum Length In Loop: <i
                                class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                I'm thinking about to remove this parameter, but I'm not sure yet.
                            </i>
                        </span>
                    </label>

                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control minimumLengthCutadaptInLoop"
                                   id="minimumLengthCutadaptInLoop"
                                   name="minimumLengthCutadaptInLoop"
                                   required="required"
                                   placeholder="{{rbcl_minimum_length_cutadapt_in_loop}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="customizedCoreNumber">
                        <span id="tooltip15"> Cutadapt Customized Core Number: <i
                                class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                PowerBarcoder supports multi-threading, set proper core number to speed up the analysis in Cutadapt.
                            </i>
                        </span>
                    </label>

                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control customizedCoreNumber"
                                   id="customizedCoreNumber"
                                   name="customizedCoreNumber" required="required"
                                   placeholder="{{rbcl_customized_core_number}}">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="minimum_overlap_base_pair">
                        <span id="tooltip96"> DADA2 Minimum Overlap Base Pair: <i
                                class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                The minimum overlap base pair, default is 12 in DADA2
                            </i>
                        </span>
                    </label>

                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control minimum_overlap_base_pair"
                                   id="minimum_overlap_base_pair"
                                   name="minimum_overlap_base_pair" required="required"
                                   placeholder="{{rbcl_minimum_overlap_base_pair}}">
                        </div>
                    </div>
                </div>


                <div class="form-group">
                    <label for="minimum_overlap_base_pair">
                        <span id="tooltip93"> DADA2 Maximum Mismatch Base Pair: <i
                                class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                The maximum mismatch base pair, default is 0 in DADA2
                            </i>
                        </span>
                    </label>

                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control maximum_mismatch_base_pair"
                                   id="maximum_mismatch_base_pair"
                                   name="maximum_mismatch_base_pair" required="required"
                                   placeholder="{{rbcl_maximum_mismatch_base_pair}}">
                        </div>
                    </div>
                </div>


                <div class="form-group advanceMode hideAdvanceMode">
                    <label for="blastReadChoosingMode">
                        <span id="tooltip95">Blast Read Choosing Mode: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                Blast Read Choosing Mode, details can be found in PowerBarcoder manual.
                            </i>
                        </span>
                    </label>

                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control blastReadChoosingMode" id="blastReadChoosingMode"
                                   name="blastReadChoosingMode"
                                   required="required" value="{{blastReadChoosingMode}}"
                                   placeholder="{{blastReadChoosingMode}}">
                        </div>
                    </div>
                </div>

                <div class="form-group advanceMode hideAdvanceMode">
                    <label for="blastParsingMode">
                        <span id="tooltip94">Blast Parsing Mode: <i class="fa fa-question-circle"></i></span>
                        <span class="text-secondary information">
                            <i>
                                Blast Parsing Mode, details can be found in PowerBarcoder manual.<br>
                                # # blast_parsing_mode == "0":<br>
                                # 1.identity: 用3排序，取最高者出來，但不低於85<br>
                                # 2.qstart-qend: 用abs(7-8)取最大，但不低於序列長度的一半<br>
                                # # blast_parsing_mode == "1":<br>
                                # 1.qstart-qend: 用abs(7-8)取最大，但不低於序列長度(qseqid_length)的一半<br>
                                # 2.identity: 用3排序，取最高者出來，但不低於85<br>
                                # # blast_parsing_mode == "2":<br>
                                # 1.qstart-qend & identity 並行，用abs(7-8)*identity取最大，但不低於序列長度的一半，且identity要大於85<br>
                                # # blast_parsing_mode == "3":<br>
                                # 1. e-value, 越小越好，但不高於0.01，1/10000代表每10000次align才可能出現一次更好的結果
                            </i>
                        </span>
                    </label>

                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control blastParsingMode" id="blastParsingMode"
                                   name="blastParsingMode"
                                   required="required" value="{{blastParsingMode}}"
                                   placeholder="{{blastParsingMode}}">
                        </div>
                    </div>
                </div>

                <br>
                <div class="d-flex align-items-center">
                    <button id="autoCompleteWithRBCL" class="btn btn-warning" type="button"
                            onclick="autoCompleteWithRBCLLoci()">
                        Demo rbcL
                    </button>
                    &nbsp;
                    <button id="autoCompleteWithTRNLF" class="btn btn-warning" type="button"
                            onclick="autoCompleteWithTRNLFLoci()">
                        Demo trnLF
                    </button>
                </div>
            </div>
        </div>


        <script>
            function autoCompleteWithRBCLLoci() {
                document.getElementById('nameOfLoci').value = '{{rbcl_name_of_loci}}'
                document.getElementById('errorRateCutadapt').value = '{{rbcl_error_rate_cutadapt}}'
                document.getElementById('minimumLengthCutadapt').value = '{{rbcl_minimum_length_cutadapt}}'
                document.getElementById('primerFName').value = '{{rbcl_primer_f_name}}'
                document.getElementById('primerF').value = '{{rbcl_primer_f}}'
                document.getElementById('primerRName').value = '{{rbcl_primer_r_name}}'
                document.getElementById('primerR').value = '{{rbcl_primer_r}}'
                // document.getElementById('amplicon_r1').value = '{{rbcL_amplicon_r1}}'
                // document.getElementById('amplicon_r2').value = '{{rbcL_amplicon_r2}}'
                document.getElementById('barcodesFile1').value = '{{rbcl_barcodes_file1}}'
                document.getElementById('barcodesFile2').value = '{{rbcl_barcodes_file2}}'
                document.getElementById('sseqidFileName').value = '{{rbcl_sseqid_file_name}}'
                document.getElementById('minimumLengthCutadaptInLoop').value = '{{rbcl_minimum_length_cutadapt_in_loop}}'
                document.getElementById('customizedCoreNumber').value = '{{rbcl_customized_core_number}}'
                document.getElementById('blastReadChoosingMode').value = '{{rbcl_blast_read_choosing_mode}}'
                document.getElementById('blastParsingMode').value = '{{rbcl_blast_parsing_mode}}'
                document.getElementById('minimum_overlap_base_pair').value = '{{rbcl_minimum_overlap_base_pair}}'
                document.getElementById('maximum_mismatch_base_pair').value = '{{rbcl_maximum_mismatch_base_pair}}'
                addRawFolderPath()
            }

            function autoCompleteWithTRNLFLoci() {
                document.getElementById('nameOfLoci').value = '{{trnlf_name_of_loci}}'
                document.getElementById('errorRateCutadapt').value = '{{trnlf_error_rate_cutadapt}}'
                document.getElementById('minimumLengthCutadapt').value = '{{trnlf_minimum_length_cutadapt}}'
                document.getElementById('primerFName').value = '{{trnlf_primer_f_name}}'
                document.getElementById('primerF').value = '{{trnlf_primer_f}}'
                document.getElementById('primerRName').value = '{{trnlf_primer_r_name}}'
                document.getElementById('primerR').value = '{{trnlf_primer_r}}'
                // document.getElementById('amplicon_r1').value = '{{trnLF_amplicon_r1}}'
                // document.getElementById('amplicon_r2').value = '{{trnLF_amplicon_r2}}'
                document.getElementById('barcodesFile1').value = '{{trnlf_barcodes_file1}}'
                document.getElementById('barcodesFile2').value = '{{trnlf_barcodes_file2}}'
                document.getElementById('sseqidFileName').value = '{{trnlf_sseqid_file_name}}'
                document.getElementById('minimumLengthCutadaptInLoop').value = '{{trnlf_minimum_length_cutadapt_in_loop}}'
                document.getElementById('customizedCoreNumber').value = '{{trnlf_customized_core_number}}'
                document.getElementById('blastReadChoosingMode').value = '{{trnlf_blast_read_choosing_mode}}'
                document.getElementById('blastParsingMode').value = '{{trnlf_blast_parsing_mode}}'
                document.getElementById('minimum_overlap_base_pair').value = '{{trnlf_minimum_overlap_base_pair}}'
                document.getElementById('maximum_mismatch_base_pair').value = '{{trnlf_maximum_mismatch_base_pair}}'
                addRawFolderPath()
            }
        </script>


        <div id="locusContainer1"></div>
        <hr id="locusHr1" class="d-none">
        <div id="locusContainer2"></div>
        <hr id="locusHr2" class="d-none">
        <div id="locusContainer3"></div>
        <hr id="locusHr3" class="d-none">
        <div id="locusContainer4"></div>
        <hr id="locusHr4" class="d-none">

        <br>

        <input id="addLocusButton" type="button" class=" btn btn-secondary" value="add new locus">

        <!-- blank div -->
        <hr>

        <div class="container">
            <div class="row">
                <div class="col-md-12 d-md-flex justify-content-md-end">
                    <input id="showModalButton" type="button" class=" btn btn-success d-none" value="View logs"
                           onclick="$('#myModal').modal('show')"> &nbsp;
                    <input id="submitButton" type="submit" class="btn btn-primary" value="Submit">
                </div>
            </div>
        </div>

    </form>

</div>


<!-- Modal -->
<div class="modal" id="myModal">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Form submitted successfully!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modalBodyDiv" style="padding-bottom: 0rem">
                <div class="text-center mb-3">
                </div>
                <div id="consoleDiv">
                <pre style="margin-bottom: 0rem" id="console">
                    <div class="d-flex justify-content-center" id="loadPreviousDiv">
                        <button class="btn btn-success" id="loadPreviousButton"
                                style="display: none;">Load Previous</button>
                    </div>
                </pre>
                </div>
            </div>
            <div class="modal-footer">
                <div class="container">
                    <div class="row">
                        <div class="col-sm">
                            <span>&nbsp</span>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="darkModeToggle">
                                <label class="form-check-label" for="darkModeToggle">Dark Mode</label>
                            </div>
                        </div>
                        <div class="col-sm d-md-flex justify-content-md-end">
                            <button class="btn btn-warning" id="downloadButton" disabled>Download Result</button>
                            &nbsp;
                            <button class="btn btn-secondary" id="clearButton">Clear Log</button>
                            &nbsp;
                            <button class="btn btn-primary" id="saveButton">Save Execution Log</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--    save the execution log   -->
            <script>
                let removedData = [];
                let max_lines = 50; // Maximum number of lines to display

                // btn for saving the console
                document.getElementById('saveButton').addEventListener('click', function () {

                    // Combine the removed data and code element text
                    let removedLogContent = removedData.join('\n') + '\n';
                    let codeElement = document.getElementById('console');
                    let codeElementCopy = codeElement.cloneNode(true);
                    let divToRemove = codeElementCopy.querySelector("#loadPreviousDiv");
                    if (divToRemove) {
                        codeElementCopy.removeChild(divToRemove);
                    }
                    let innerText = (removedLogContent + codeElementCopy.innerText)
                        .replaceAll("                ", "")
                        .replace("                    [", "[")
                        .replaceAll("<", "&lt;")
                        .replaceAll(">", "&gt;");
                    // Create a temporary anchor element to trigger the file download
                    let downloadLink = document.createElement('a');
                    downloadLink.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(innerText);
                    downloadLink.download = 'log.txt';
                    downloadLink.style.display = 'none';
                    document.body.appendChild(downloadLink);
                    // Simulate a click on the anchor element to trigger the file download
                    downloadLink.click();
                    // Clean up the temporary anchor element
                    document.body.removeChild(downloadLink);
                });

                // btn for clearing the console
                document.getElementById('clearButton').addEventListener('click', function () {
                    // $("#console").empty();
                    $("#console").children().not("#loadPreviousDiv").remove();
                    removedData = []
                });

                let socket = io.connect('{{ request.host_url }}', {
                    withCredentials: true,
                });

                socket.on('procedure-result', function (data) {
                    // update console with data by appending the new <div> to the console element
                    let newDiv = $("<code>");
                    newDiv.text(data);
                    $("#console").append(newDiv);
                    newDiv.addClass("shellsession");

                    // don't forget to highlight the div if dark mode is on
                    if ($('#darkModeToggle').is(":checked")) {
                        hljs.highlightAll();
                    }

                    // Remove older content if necessary
                    let lines = $("#console").find("code").length;
                    console.log(lines)
                    if (lines > max_lines) {
                        let firstLine = $("#console").find("code:first");
                        let removedLine = firstLine.text().trim(); // Adjust based on your needs
                        removedData.push(removedLine);
                        firstLine.remove();
                        $("#loadPreviousButton").show();

                    }

                    // // Scroll to the bottom of the output div
                    // let consoleDiv = document.getElementById('consoleDiv');
                    // let modalBodyDiv = document.getElementById('modalBodyDiv');
                    // modalBodyDiv.scrollTo({
                    //     top: consoleDiv.scrollHeight,
                    //     behavior: 'smooth'
                    // })

                    // set room name in session storage
                    if (data.includes("Socket room name:")) {
                        let roomName = data.split(":")[1].trim();
                        sessionStorage.setItem('roomName', roomName);
                    }

                    // add download button when the result is ready
                    if (data.includes("Find your results in")) {
                        // Download Result
                        document.getElementById('downloadButton').disabled = false;
                    }

                });

                // Event listener for the button click event
                $("#loadPreviousButton").click(function () {
                    // Function to load and prepend previous data to the console content
                    if (removedData.length > 0) {
                        let previousData = removedData.pop();
                        let newDiv = $("<code>");
                        newDiv.text(previousData + "\n");
                        newDiv.insertBefore($("#console code:first"));
                        newDiv.addClass("shellsession");
                        max_lines += 1;
                    }
                    // Update the button visibility
                    if (removedData.length === 0) {
                        $("#loadPreviousButton").hide();
                    }
                });


                // Download result button
                document.getElementById('downloadButton').addEventListener('click', function () {
                    // get room name from session storage
                    let roomName = sessionStorage.getItem('roomName');
                    // call api to download the result by room name (path parameter) in new page
                    window.open('{{ request.host_url }}' + 'download/' + roomName, '_blank');
                });


                $('#darkModeToggle').on("change", function (event) {
                    if ($(this).is(":checked")) {
                        $('code').each(function () {
                            hljs.highlightElement(this);
                        });
                    } else {
                        $('.hljs').removeClass('hljs');
                        $('.hljs').removeClass('language-shell');
                    }
                });

                $(document).on("submit", 'form', function (event) {
                    // Prevent default form submission
                    event.preventDefault();

                    // Collect form data
                    const formData = {
                        // 'myCutadaptPath': $('#myCutadaptPath').val(),
                        // 'myFastpPath': $('#myFastpPath').val(),
                        // 'localBlastToolDir': $('#localBlastToolDir').val(),
                        'ampliconInfo': $('#ampliconInfo').val(),
                        // 'resultDataPath': $('#resultDataPath').val(),
                        // 'missList': $('#missList').val(),
                        'R1FastqGz': $('#R1FastqGz').val(),
                        'R2FastqGz': $('#R2FastqGz').val(),
                        // 'summaryJsonFileName': $('#summaryJsonFileName').val(),
                        // 'summaryHtmlFileName': $('#summaryHtmlFileName').val(),
                        'dada2LearnErrorFile': $('#dada2LearnErrorFile').val(),
                        'dada2BarcodeFile': $('#dada2BarcodeFile').val(),
                        'dev_mode': $('#dev_mode').val(),
                        'amplicon_minimum_length': $('#amplicon_minimum_length').val(),

                        'nameOfLoci': $('.nameOfLoci').map(function () {
                            return $(this).val();
                        }).get(),
                        'errorRateCutadapt': $('.errorRateCutadapt').map(function () {
                            return $(this).val();
                        }).get(),
                        'minimumLengthCutadapt': $('.minimumLengthCutadapt').map(function () {
                            return $(this).val();
                        }).get(),
                        'primerFName': $('.primerFName').map(function () {
                            return $(this).val();
                        }).get(),
                        'primerF': $('.primerF').map(function () {
                            return $(this).val();
                        }).get(),
                        'primerRName': $('.primerRName').map(function () {
                            return $(this).val();
                        }).get(),
                        'primerR': $('.primerR').map(function () {
                            return $(this).val();
                        }).get(),
                        // 'amplicon_r1': $('.amplicon_r1').map(function () {
                        //     return $(this).val();
                        // }).get(),
                        // 'amplicon_r2': $('.amplicon_r2').map(function () {
                        //     return $(this).val();
                        // }).get(),
                        'barcodesFile1': $('.barcodesFile1').map(function () {
                            return $(this).val();
                        }).get(),
                        'barcodesFile2': $('.barcodesFile2').map(function () {
                            return $(this).val();
                        }).get(),
                        'sseqidFileName': $('.sseqidFileName').map(function () {
                            return $(this).val();
                        }).get(),
                        'minimumLengthCutadaptInLoop': $('.minimumLengthCutadaptInLoop').map(function () {
                            return $(this).val();
                        }).get(),
                        'customizedCoreNumber': $('.customizedCoreNumber').map(function () {
                            return $(this).val();
                        }).get(),
                        'blastReadChoosingMode': $('.blastReadChoosingMode').map(function () {
                            return $(this).val();
                        }).get(),
                        'blastParsingMode': $('.blastParsingMode').map(function () {
                            return $(this).val();
                        }).get(),
                        'minimum_overlap_base_pair': $('.minimum_overlap_base_pair').map(function () {
                            return $(this).val();
                        }).get(),
                        'maximum_mismatch_base_pair': $('.maximum_mismatch_base_pair').map(function () {
                            return $(this).val();
                        }).get(),
                    }

                    // Serialize form data
                    // let formData = $('form').serialize();
                    console.log(formData)

                    // Show the modal
                    $("#myModal").modal("show")
                    $("#showModalButton").removeClass("d-none")
                    socket.emit('run-procedure', formData);

                    // Disable the submit button
                    $('#submitButton').prop('disabled', true);
                    // Show the countdown text
                    $('#submitButton').val('Please wait...');

                    // Start the countdown
                    let seconds = 70;
                    let countdownInterval = setInterval(function () {
                        seconds--;
                        if (seconds > 0) {
                            $('#submitButton').val('Please wait... ' + seconds + 's');
                        } else {
                            // Enable the submit button and restore its original value
                            $('#submitButton').prop('disabled', false).val('Submit');
                            clearInterval(countdownInterval);
                        }
                    }, 1000);
                });
            </script>
        </div>
    </div>
</div>
<hr>


<script>
    let locusContainerCount = 0;

    // Get the button element
    const addButton = document.getElementById('addLocusButton');


    // Add an event listener to the button
    addButton.addEventListener('click', function () {
        locusContainerCount++
        let idString = 'locusContainer' + locusContainerCount.toString();
        // Get the container element where the new DOM will be appended
        const container = document.getElementById(idString);

        // Create a new div element
        const newDiv = document.createElement('div');

        // Create the content for the new div element
        const content = `
<div class="border border-gray p-3 bg-light">
            <div class="d-flex align-items-center">
                <h4 class="m-0">Locus</h4>
                <button id="locusFormContainerToggleBtn${locusContainerCount.toString()}" class="btn btn-primary dropdown-toggle ms-auto" type="button"
                        data-bs-toggle="collapse" href="#locusFormContainer${locusContainerCount.toString()}" aria-expanded="false" aria-controls="pathFormContainer">
                    Hide the Locus Form
                </button>
            </div>
            <div id="locusFormContainer${locusContainerCount.toString()}" class="mt-3  collapse">
                <div class="form-group">
                    <label for="nameOfLoci">Name of Loci:</label>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control nameOfLoci" id="nameOfLoci" required="required" name="nameOfLoci" placeholder="{{rbcl_name_of_loci}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="primerF">Primer F:</label>
                    <div class="row">
                        <div class="col">
                            <input type="text" class="form-control primerFName" required="required"
                                   placeholder="{{rbcl_primer_f_name}}" id="primerFName" name="primerFName">
                        </div>
                        <div class="col">
                            <input type="text" class="form-control primerF" id="primerF"
                                   name="primerF" required="required"
                                   placeholder="{{rbcl_primer_f}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="primerR">Primer R:</label>
                    <div class="row">
                        <div class="col">
                            <input type="text" class="form-control primerRName" required="required"
                                   placeholder="{{rbcl_primer_r_name}}" id="primerRName" name="primerRName">
                        </div>
                        <div class="col">
                            <input type="text" class="form-control primerR" id="primerR"
                                   name="primerR" required="required"
                                   placeholder="{{rbcl_primer_r}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="barcodesFile1">Barcodes File 1:</label>
                    <div class="row">
                        <div class="col">
                            <input type="text" class="form-control rawFolderPath" required="required"
                                   placeholder="{{TODO}}"  disabled="disabled">
                        </div>
                        <div class="col">
                            <input type="text" class="form-control barcodesFile1" id="barcodesFile1" required="required"
                                   name="barcodesFile1" placeholder="{{rbcl_barcodes_file1}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="barcodesFile2">Barcodes File 2:</label>
                    <div class="row">
                         <div class="col">
                            <input type="text" class="form-control rawFolderPath" required="required"
                                   placeholder="{{TODO}}"  disabled="disabled">
                        </div>
                        <div class="col">
                            <input type="text" class="form-control barcodesFile2"
                                   id="barcodesFile2" required="required"
                                   name="barcodesFile2" placeholder="{{rbcl_barcodes_file2}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="sseqidFileName">Sseqid File:</label>
                    <div class="row">
                        <div class="col">
                            <input type="text" class="form-control rawFolderPath" required="required"
                                   placeholder="{{TODO}}"  disabled="disabled">
                        </div>
                        <div class="col">
                            <input type="text" class="form-control sseqidFileName"
                                   id="sseqidFileName" required="required"
                                   name="sseqidFileName" placeholder="{{rbcl_sseqid_file_name}}">
                        </div>
                    </div>
                </div>
                                <div class="form-group">
                    <label for="errorRateCutadapt"> Cutadapt Error Rate:</label>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control errorRateCutadapt" id="errorRateCutadapt" required="required"
                                   name="errorRateCutadapt" placeholder="{{rbcl_error_rate_cutadapt}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="minimumLengthCutadapt"> Cutadapt Minimum Length:</label>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control minimumLengthCutadapt" id="rbcl_minimum_length_cutadapt" required="required"
                                   name="rbcl_minimum_length_cutadapt" placeholder="{{rbcl_minimum_length_cutadapt}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="minimumLengthCutadaptInLoop"> Cutadapt Minimum Length In Loop:</label>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control minimumLengthCutadaptInLoop"
                                   id="minimumLengthCutadaptInLoop" required="required"
                                   name="minimumLengthCutadaptInLoop" placeholder="{{rbcl_minimum_length_cutadapt_in_loop}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="customizedCoreNumber">Cutadapt Customized Core Number:</label>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control customizedCoreNumber"
                                   id="customizedCoreNumber" required="required"
                                   name="customizedCoreNumber" placeholder="{{rbcl_customized_core_number}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="minimum_overlap_base_pair"> DADA2 Minimum Overlap Base Pair:</label>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control minimum_overlap_base_pair"
                                   id="minimum_overlap_base_pair"
                                   name="minimum_overlap_base_pair" required="required"
                                   placeholder="{{rbcl_minimum_overlap_base_pair}}">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="minimum_overlap_base_pair"> DADA2 Maximum Mismatch Base Pair:</label>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control maximum_mismatch_base_pair"
                                   id="maximum_mismatch_base_pair"
                                   name="maximum_mismatch_base_pair" required="required"
                                   placeholder="{{rbcl_maximum_mismatch_base_pair}}">
                        </div>
                    </div>
                </div>
                <div class="form-group advanceMode hideAdvanceMode">
                    <label for="blastReadChoosingMode">
                        Blast Read Choosing Mode:
                    </label>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control advanceMode blastReadChoosingMode" id="blastReadChoosingMode"
                                   name="blastReadChoosingMode"
                                   required="required" value="{{rbcl_blast_read_choosing_mode}}"
                                   placeholder="{{rbcl_blast_read_choosing_mode}}">
                        </div>
                    </div>
                </div>
                <div class="form-group advanceMode hideAdvanceMode">
                    <label for="blastParsingMode">
                        Blast Parsing Mode:
                    </label>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control advanceMode blastParsingMode" id="blastParsingMode"
                                   name="blastParsingMode"
                                   required="required" value="{{rbcl_blast_parsing_mode}}"
                                   placeholder="{{rbcl_blast_parsing_mode}}}">
                        </div>
                    </div>
                </div>
            </div>
        </div>
`;

        // Set the innerHTML of the new div element to the content
        newDiv.innerHTML = content;
        // Append the new div element to the container element
        container.appendChild(newDiv);

        // disable the add button if the number of locus container is 4
        if (locusContainerCount === 4) {
            addButton.disabled = true;
        }

        addRawFolderPath()

    });

</script>
<script>
    function addRawFolderPath() {
        let rawFolderPathOriginDiv = document.getElementById("ampliconInfo");
        let rawFolderPathDestinationDivCollection = document.getElementsByClassName("rawFolderPath");
        for (let rawFolderPathDestinationDiv of rawFolderPathDestinationDivCollection) {
            rawFolderPathDestinationDiv.value = rawFolderPathOriginDiv.value;
        }
    }
</script>

</body>
</html>
